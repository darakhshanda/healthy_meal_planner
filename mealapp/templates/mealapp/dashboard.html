{% extends 'base.html' %}
{% load static %}

{% block title %}Profile Setup - Healthy Meal Planner{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0"><i class="fas fa-user-circle"></i> Complete Your Profile</h3>
                </div>

                <div class="card-body">
                    {% if messages %}
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    {% endfor %}
                    {% endif %}

                    <p class="text-muted mb-4">
                        <i class="fas fa-info-circle"></i>
                        Let's calculate your BMI and personalized daily calorie goal.
                    </p>

                    <form method="POST" class="needs-validation" novalidate>
                        {% csrf_token %}

                        <!-- Age Field -->
                        <div class="mb-3">
                            <label for="{{ form.age.id_for_label }}" class="form-label fw-bold">
                                {{ form.age.label }} *
                            </label>
                            {{ form.age }}
                            {% if form.age.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.age.errors %}
                                    <i class="fas fa-exclamation-circle"></i> {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                            {% if form.age.help_text %}
                            <div class="form-text">{{ form.age.help_text|safe }}</div>
                            {% endif %}
                        </div>

                        <!-- Gender Field -->
                        <div class="mb-3">
                            <label for="{{ form.gender.id_for_label }}" class="form-label fw-bold">
                                {{ form.gender.label }} *
                            </label>
                            {{ form.gender }}
                            {% if form.gender.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.gender.errors %}
                                    <i class="fas fa-exclamation-circle"></i> {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- Height Field -->
                        <div class="mb-3">
                            <label for="{{ form.height_cm.id_for_label }}" class="form-label fw-bold">
                                {{ form.height_cm.label }} *
                            </label>
                            {{ form.height_cm }}
                            {% if form.height_cm.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.height_cm.errors %}
                                    <i class="fas fa-exclamation-circle"></i> {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                            {% if form.height_cm.help_text %}
                            <div class="form-text">{{ form.height_cm.help_text|safe }}</div>
                            {% endif %}
                        </div>

                        <!-- Weight Field -->
                        <div class="mb-3">
                            <label for="{{ form.weight_kg.id_for_label }}" class="form-label fw-bold">
                                {{ form.weight_kg.label }} *
                            </label>
                            {{ form.weight_kg }}
                            {% if form.weight_kg.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.weight_kg.errors %}
                                    <i class="fas fa-exclamation-circle"></i> {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                            {% if form.weight_kg.help_text %}
                            <div class="form-text">{{ form.weight_kg.help_text|safe }}</div>
                            {% endif %}
                        </div>

                        <!-- Activity Level Field -->
                        <div class="mb-4">
                            <label for="{{ form.activity_level.id_for_label }}" class="form-label fw-bold">
                                {{ form.activity_level.label }}
                            </label>
                            {{ form.activity_level }}
                            {% if form.activity_level.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.activity_level.errors %}
                                    <i class="fas fa-exclamation-circle"></i> {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                            {% if form.activity_level.help_text %}
                            <div class="form-text">{{ form.activity_level.help_text|safe }}</div>
                            {% endif %}
                        </div>

                        <!-- Current Metrics Display -->
                        {% if profile.bmi or profile.daily_calorie_goal %}
                        <div class="alert alert-success mb-4">
                            <h6 class="alert-heading mb-3">
                                <i class="fas fa-chart-line"></i> Your Calculated Metrics
                            </h6>
                            
                            {% if profile.bmi %}
                            <div class="row mb-3">
                                <div class="col-6">
                                    <p class="mb-1"><strong>BMI:</strong></p>
                                    <h5 class="text-success">{{ profile.bmi|floatformat:1 }}</h5>
                                </div>
                                <div class="col-6">
                                    <p class="mb-1"><strong>Category:</strong></p>
                                    <h5>
                                        <span class="badge bg-{{ profile.get_bmi_color }}">
                                            {{ profile.get_bmi_category }}
                                        </span>
                                    </h5>
                                </div>
                            </div>
                            <hr class="my-2">
                            {% endif %}
                            
                            {% if profile.daily_calorie_goal %}
                            <p class="mb-1"><strong>Daily Calorie Goal:</strong></p>
                            <h5 class="text-success">
                                <i class="fas fa-fire text-danger"></i> {{ profile.daily_calorie_goal }} kcal
                            </h5>
                            {% endif %}
                        </div>
                        {% endif %}

                        <!-- BMI Info Box -->
                        <div class="card bg-light mb-4 border-0">
                            <div class="card-body">
                                <h6 class="card-title mb-2"><i class="fas fa-info-circle text-info"></i> BMI Categories</h6>
                                <small class="text-muted">
                                    <div><strong>&lt; 18.5:</strong> Underweight</div>
                                    <div><strong>18.5 - 24.9:</strong> Normal weight</div>
                                    <div><strong>25 - 29.9:</strong> Overweight</div>
                                    <div><strong>â‰¥ 30:</strong> Obese</div>
                                </small>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-check-circle"></i> Save Profile & Calculate
                            </button>
                        </div>

                        <!-- Skip Button -->
                        <div class="text-center mt-3">
                            <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">
                                Skip for Now
                            </a>
                        </div>

                        <p class="text-center text-muted mt-4 small">
                            <i class="fas fa-shield-alt"></i> Your data is secure and only used for personalization.
                        </p>
                    </form>
                </div>
            </div>

            <!-- Progress Indicator -->
            <div class="text-center mt-4">
                <small class="text-muted">
                    <i class="fas fa-circle-check text-success"></i> 
                    Account Created &nbsp;
                    <i class="fas fa-arrow-right"></i>
                    &nbsp;
                    <i class="fas fa-user text-primary fw-bold"></i> 
                    Profile Setup &nbsp;
                    <i class="fas fa-arrow-right"></i>
                    &nbsp;
                    <i class="fas fa-chart-line text-muted"></i> 
                    Dashboard
                </small>
            </div>
        </div>
    </div>
</div>


{% endblock %}